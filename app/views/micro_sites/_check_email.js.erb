
function check_email() {
	if(!email) {
		$('#user_name').closest('div').fadeOut();
		$('#user_password').closest('div').fadeOut();
		return;
	}
	
	$.getJSON( "<%= users_path() %>/check",
		{
			email: email
		},
		function(data) {
			var d = $.parseJSON(data);
			if(d === true) {
				$('#user_name').closest('div').hide();
				$('#user_password').closest('div').fadeIn();
			} else {
				$('#user_password').closest('div').hide();
				$('#user_name').closest('div').fadeIn();
			}
		}
	);
}

$(function() {
	
	$('#user_password').closest('div').hide();
	$('#user_name').closest('div').hide();
	
	$('#user_email').keyup(function() {
		
		if(keyup_mutex)
			window.clearTimeout(keyup_mutex);
		
		email = $(this).val();
		
		
		
		keyup_mutex = window.setTimeout(check_email, 500);
	});
	
	$('#user_email').delay(2000).keyup();
});

var email;
var keyup_mutex;